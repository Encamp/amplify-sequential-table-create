# amplify-sequential-table-create

The @model directive from the AWS Amplify framework causes a Dynamo table to be created. All of these tables are created in parallel. Dynamo has limits on how many tables can be created in parallel; if an amplify project has more than some number of @models in its schema, creating a new environment will fail with an error:

```
Subscriber limit exceeded: You have exceeded the maximum number of indexed tables that can be created simultaneously (Service: AmazonDynamoDBv2; Status Code: 400; Error Code: LimitExceededException;
```

One solution to this issue is to create the tables serially instead of in parallel. To do this, we can insert an entry in the DependsOn list of some dynamo resources in the CloudFormation template, such that they depend on other dynamo resources and therefore will not start creating until their dependencies have finished.

Because the CloudFormation template that creates the Dynamo tables is generated by Amplify upon each build, and is not in source control, making changes to it manually will still not allow the cloud CD pipeline to function; it will simply get re-created from scratch in there, and any local changes you've made will be lost. Thus you must make the changes locally, and then do an `amplify push --no-gql-override` command so that your CLI will actually push up the edited files instead of regenerating them again.

This package is a plugin to the amplify CLI that will automatically make those DependsOn edits for you upon calling `amplify push`, freeing you from needing to make tedious local copy+paste changes and relieving you of the need to remember the `--no-gql-override` flag.

Currently, the changes this plugin makes are:

- Add a DependsOn to each @model-generated substack resource, except for the first one, pointing to its predecessor.
  This is only necessary upon initial environment creation, or if you were somehow adding over a dozen new models all at once (I'm not sure what the cutoff is, and it apparently can vary anyway). However, it will not cause any harm if it is done on subsequent local pushes, except it may make your push take slightly longer than necessary. Encamp discourages local pushes anyway.

Great thanks to @mormsbee from whom we forked this project.
